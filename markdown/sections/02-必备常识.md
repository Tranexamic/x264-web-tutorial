## 必备常识

### 性能是什么

主要分为处理速度/算力和数据传输速度/带宽，部分情况下还注重操作响应速度/延迟。播放视频时，画面卡顿问题往往来自于某一处的带宽不足（如网速、硬盘带宽）；而另一种情况下，如果让性能太弱的 CPU 播放高度压缩后的视频，那么即使带宽充足，视频也会因为算力不足而卡顿。

数据与 CPU 核心的距离，以及使用的数据传输协议会导致巨大的延迟差异。在此之上还有因为同步，分阶段读取，安全检查，纠错校验等行为而积微成著：

| 数据位置  | 读取 CPU 周期        | 估计用时       |
| ----- | ---------------- | ---------- |
| L1 缓存 | 3                | 1 ns       |
| L2 缓存 | 10\~20           | 3\~7 ns    |
| L3 缓存 | 30\~70           | 10\~25 ns  |
| 内存    | 180\~360         | 60\~120 ns |
| 固态硬盘  | 240,000\~900,000 | 80\~300 μs |
| 机械硬盘  | 41,000,000       | 14 ms      |
| 互联网   | 240,000,000      | 80 ms      |

#### 读写性能（IO）

硬盘或闪存芯片上的数据写入速度普遍比内存慢得多，但容量大且断电不丢失，是本地读写性能的主要瓶颈。实际读写性能通常分为两类，其性能差异相当于一次 vs. 成千上万次操作的区别。

- **连续读写**：适用于大文件，速度快
- **随机小文件读写（4K 性能）**：由于每个文件至少占 4KB 空间，造成大量额外的寻址与读写，速度可能只有前者的一到两成

视频文件属于大文件，而且封装格式将音轨、字幕等数据紧密存放，因此即便是连续读写性能较低的存储介质（如闪存），其带宽也能保证播放流畅

### 数据是什么

一句话就是一段数据。计算机上的数据由电信号构成，分为模拟（电压代表大小）和数字（0、1 代表开关）两种。通过将计算机编程，人们根据不同的 0、1 长度以及组合，为 CPU 定义了操作内存、硬盘等存储设备的（读写）能力，从而使得更上层的操作系统和程序能够定义和使用更抽象化的数据（如坐标，像素值）等形式，才得以让电脑显示画面，播放视频。

### 元数据（Metadata）

描述数据的数据，例如零食的包装袋上会印有零食的参考图和名称。如果所有的包装都是白色，那么用户就无法找到想吃的零食。而电脑只能根据每个格式元数据（一般为文件后缀名）预设的“默认程序”来打开视频文件（设置错误时，也强行让设定的程序打开），而视频播放器也需要编码格式、亮度、对比度、帧率等元数据才能正确的播放视频。

### 编解码是什么

- **编码 Encoding**：是数据格式的转换。压缩是编码的一种形式
- **解码 Decoding**：是将被压缩的信号还原或播放的解压缩。一般来说，压缩程度越高，解码速度越慢
- **软解 Software Decoding**：使用通用电路播放流文件，通常具有更高的兼容性，更高的能耗/发热
- **硬解 Hardware Decoding**：使用专用电路替代软解，通常具有更低的兼容性，更低的能耗/发热
  - 例如：libmxv，opencl，MMAL，direct3D
- **软编 Software Encoding**：使用通用电路运行算法逻辑编码流文件，通常具有更完整的压缩功能但速度较慢，能耗/发热较高，同码率下的画质更高
  - 运行时占用 CPU 核心、GPU CUDA/ROCm/OpenCL 通用计算单元、或高端采集卡中的 FPGA 核心
- **硬编 Hardware Encoding**：使用专用电路编码流文件，通常具有较少的功能但速度更快，发热更低
  - 常见的有 NVENC，MMF/Venus，Intel-QSV，AMD-AMF，Elgato

### 封装与解封装——(De-)multiplex

- 类似于 .zip .rar 文件将多个文件（视频，音频，字幕，字体）合并为一个文件的功能
- 信号处理中，电台将多路音频流封装为一段模拟信号，接收端通过调整接收频率来接收其中一路信号，每路信号占据一定的频宽/带宽

封装文件记录了视频帧率、音视频同步、色彩标识等关键元数据，播放器根据它们选择和配置解码器。常见的封装文件有：

| 📦格式（全称）                            | 用途                                     | 特点                                                                                                                                          |
| ----------------------------------- | -------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------- |
| MP4 (MPEG-4 Part 14)                | 网络与本地播放                                | 兼容性广，几乎所有设备和平台都支持 压缩元数据，进一步缩小文件体积 支持主要的视频、音频格式，部分字幕格式 不支持特效字幕（如 ASS/SSA） 整个文件写完后才统计并写入元数据，因此不适合录制（录制程序崩溃后整个视频损坏）                            |
| MKV (Matroska Multimedia Container) | 本地播放、多音轨/多字幕内容、实时录制                    | 轨道数量无限制 各种现存与未来的视频、音频、字幕格式 支持逐段存储元数据，录制程序崩溃后只有最后一段内容会损坏，因此适合录制 Adobe Premiere、After Effects、Media Encoder、Audition 版本 25.2 添加了原生支持 网络播放兼容性差 |
| MOV (QuickTime File Format)         | 本地播放、视频编辑                              | 用于苹果公司软硬件生态，以及其私有的视音频格式（如 ProRes） Adobe Premiere 等专业软件长期支持 通常文件较大，但质量较高                                                                     |
| M4A (MPEG-4 Audio)                  | 纯音频存储、音乐播放                             | 专门用于音频的 MPEG-4 格式 支持多种音频编解码器（如 AAC、ALAC） 支持封装封面图片和元数据                                                                                       |
| FLV (Flash Video)                   | 网络与本地播放、实时录制                           | 简单轻量，适合网络传输 由于结构简单，因此在录制程序崩溃后几乎无损 随着 2020 年底 Flash 的淘汰而退出主流 视频、音频格式最高只支持到 AVC、AAC，但也有一些扩展支持 H.265，被 HLS（M3U+TS）和 MP4 流取代                    |
| M3U/M3U8 (MPEG URL Playlist)        | 定义播放列表（本地媒体、流媒体，如 HTTP Live Streaming） | 文本列表，HLS 客户端根据它从 CDN、P2P 下载并按顺序排列 TS 封装的小片段 部分 HLS 客户端中有缓存 TS 并上传给其它客户端的扩展实现 M3U8 使用 UTF-8 文本编码，是前者的扩展版本                                    |
| TS (MPEG Transport Stream)          | 广播电视、流媒体传输、录制                          | 最初为数字电视广播设计（DVB、ATSC） 结构基于固定大小的包，减少丢包造成的播放问题 原生支持边录边播（同时直播和录制） 比 MP4/MKV 冗余多，文件体积稍大，元数据支持较弱 几乎所有播放器和硬件解码器都支持                                |

### 视频编码专利

常见的有核心技术专利（特定编码步骤、装置设备具体实现等应用）、标准必要专利（即构成 AVC、HEVC、AV1 等编码所需的专利）、免费开放许可等。由于涉及视频编码的专利/权利人多，因此一种视频编码是由多项专利打包的专利池所构成，由专利池管理公司运营。

HEVC 的专利许可最初混乱且昂贵，与 AVC 的许可方式截然不同。实际上这个问题显著阻碍了 HEVC 的推广，主要的专利池包括：

- HEVC Advance：包含三星、高通、GE、杜比等公司的专利
- MPEG LA：包含来自三菱、日本广播协会 NHK、JVC Kenwood、苹果等公司的专利
- Velos Media：包含来自爱立信、松下、索尼等公司的专利

![Pay-For-HEVC-Windows](files/basics/Pay-For-HEVC-Windows.webp)

图：Windows 文件管理器预览 HEVC 编码视频、HEIF 图像的组件，定价 $0.99 USD。通过让用户支付这比费用。\
微软以“产品默认不包含”而绕过了 HEVC 的专利费。

### 数据大小单位

- **bit（比特）**：最小的计量单位，\\(1 \text{bit} = \frac{1}{8} \text{Byte}\\)，衡量传输流量
- **Byte（字节）**：\\(8 \text{bit} = 1 \text{Byte}\\)，衡量文件大小

#### 二进制千进位（准确）

- **kibi-bit（Kb，千比特）**：1024 比特，210
- **kibi-Byte（KB，千字节）**：1024 字节，210
- **mebi-bit（Mb，兆比特）**：10242 = 1048576 比特
- **mebi-Byte（MB，兆字节）**：10242 = 1048576 字节
- **gibi-bit（Gb，吉比特）**：10243 = 1073741824 比特
- **gibi-Byte（GB，吉字节）**：10243 = 1073741824 字节

#### 十进制千进位（模糊）

- **kilo-bit（Kb，Kib，千比特）**：1000 比特
- **kilo-Byte（KB，KiB，千字节）**：1000 字节
- **mega-bit（Mb，Mib，兆比特）**：10002 比特
- **mega-Byte（MB，MiB，兆字节）**：10002 字节
- **giga-bit（Gb，Gib，吉比特）**：10003 比特
- **giga-Byte（GB，GiB，吉字节）**：10003 字节

![Data-Sizes](files/basics/Data-Sizes.png)

图：比特，字节与体积时间比的转换

操作系统（处理器、内存）的“字节”是以二进制换算的，而储存容量（闪存、硬盘）的“字节”是十进制换算的。一开始储存容量不大，而 1000 进和 1024 进差 2.4%，不如多卖电脑重要，就有了现在不统一的容量称呼

- 使用十进制表示数据和容量大小除了不准确外，还是会比二进制方便很多
- Mac OS X 10.6 开始整个系统都以十进制表示大小
- 为了兼容，Windows 系统的单位可能永远都不会改

### 码率/比特率（Bitrate）

文件体积每秒，单位 bps，Bps，Kbps，KBps，Mbps，MBps，Gbps，GBps 等。“ps”即 per second，也可写作“Kb/s，Mb/s”等。

- 长 1 分钟，10MB 大小的视频文件的平均码率为\\( (10 \div 1 \times 60) \times 8 \text{bit} = 1333.3 \text{Kbps} \\)
- 同样 10MB 的视频下载 1 分钟，平均下来网速即\\( \frac{10}{1 \times 60}=166.67 \text{KBps} \\)，\\( 166.67\times 8 \text{bit} = 1333.33 \text{Kbps} \\)
  - 这里的 ÷1 代表缩放到一分钟范围，×60 代表缩放到一秒，×8bit 代表 1 Byte 转 8 bit。

### 存储技术带宽 Storage Bandwidth

视频属于大文件，写入和读取操作属于几乎不存在随机读写性能的连续大文件读写。因此写入视频的速度可以直接按照硬盘的连续写入带宽/速度看待：

- **PCIe 4.0x4 SSD**：约 63Gbps（8GBps）

- **PCIe 3.0x4 SSD**：约 31Gbps（4GBps），同时也是 PCIE 4.0x2 SSD 带宽

- **3840x2160x120 未压缩 RGB 3×8bit 视频流（120 fps）**：约 24Gbps

- **3840x2160x90 未压缩 RGB 3×8bit 视频流（90 fps）**：约 18Gbps

- **3840x2160x120 无损压缩 YUV 8bit 视频流（估计）**：

  - **4:2:0**：≈ 7.2 Gbps
  - **4:2:2**：≈ 9.6 Gbps
  - **4:4:4**：≈ 14.4 Gbps

- **SATA3 SSD**：有效带宽约 4.8Gbps

当然，24Gbps 的写入量太过夸张，只要 300 多秒就会写满 8000Gb（1TB）的空间，这个大小也注定与网络传输无缘了。

注：固态硬盘实则数据详见 [TomsHardware](https://www.tomshardware.com/features/ssd-benchmarks-hierarchy)。

### 色彩

人眼感光细胞捕获特定强度的电磁波（可见光），然后通过大脑处理，产生了我们所看到的幻觉。实际上，色彩只有一个标量属性，即频率。

![Color-Spectrum1](files/basics/Color-Spectrum.png)

图：色彩的波形频率变化，见[维基百科](https://en.wikipedia.org/wiki/Electromagnetic_spectrum)。

### 亮度

- **物理亮度**：可见光电磁波的强度或振幅，以流明 lumen/lm，坎德拉/烛光 candela/cd，或尼特 nits/cdm2 计量：

  - 1cd/lm 大约为一支蜡烛的亮度
  - 由于能量（电压、焦耳）与亮度正相关，所以往往被直接称为 i“能量”
  - 尼特代表 1cd 光源投射到一平方米（一般情况下距离一米）区域后所剩的亮度，主要用于显示器的亮度设定
  - 一般来说 \\(1 \text{nit} \approx 3.426 \text{lm}\\)，但实际的“汇率”取决于光源和测量仪器/方法

- **软硬件亮度**：代表灰度像素值的大小，值越大表示像素点越亮，但最大亮度受硬件和用户设定限制。伽马 gamma/Y 值定义了像素的亮度范围，最小值 0 为黑色：

  - 4bit 位深最大值/纯白为 15（`0xF`）
  - 8bit 位深最大值/纯白色为 255（`0xFF`）
  - 10bit 位深最大值/纯白色为 1023（`0x3FF`）

YUV / YCbCr 色彩空间图像的亮度平面 Y，或者 RGB 图像分离出的亮度/灰度平面，有时也被称为伽马平面或 Y 平面。

### 灰度/灰阶 Grayscale

代表将色彩信息去除，只保留黑、灰、白色的单通道图像。

### 硬件色深 Depth 与范围 Range

对应电压的缩放值。由显示器的驱动板/主控板接收 GPU 输出的数字信号，并转义为像素点的电压得到。因此使用了 CRT 显像管的电视可能是模拟电视，也可能是数字电视，取决于有没有如 HDMI，DisplayPort 等数字信号接口。

#### 有限色深（Limited/Analog/TV）

模拟电视使用了 \\( 0 \text{mV \~ } 700 \text{mV} \\) 的输入电压表示色深，对应软件的完整色深。但早期的模拟电视缺乏电压限制功能——倘若电视台的信号调制器（类似于家庭网络的猫、Modem）出现偏差或干扰，就可能有大量用户的电视出现烧屏现象。所以显示标准上要求信号层面限制电压范围，牺牲一些色深来解决问题，得到了有限范围。

到了数字时代，电视厂商都使用 HDMI 协议的显示信号接口，电脑厂商则使用 DisplayPort 的显示信号接口，所以在“电脑接电视”，和“游戏主机接显示器”时往往需要额外的输入和输出设置，才能得到明暗过渡正常的画面。

- 一般在显示器的 OSD 设置界面上看到，写作兼容/有限/模拟/电视范围
- 一般来说，数字显示器/数字电视应该是原生支持设置为输入完整色深的，若没有则可以通过设置 HDMI Black Level 来缩放到正常明暗过渡

### 软件的色深 Depth 与范围 Range

数字色深的分阶用位/bit 表示。如四位 4bit（16 单位）\\(2^4\\)、八位 8bit（256 单位）\\(2^8\\)、10bit（1024 单位）\\(2^{10}\\) 的形式表示。

![Full-and-Limited-Range](files/basics/Full-and-Limited-Range.png)

图：完整/PC 色深（Full）与有限/TV 色深（Limited），包括上述说明的更优版本见[硬件茶谈](https://www.youtube.com/watch?v=8sAJWtgQ2t8)。

#### 完整色深兼容有限色深

点击展开/折叠内容

- 8 位色深下，从完整 0\~255 缩减至 16\~235 的有限区间（256 深）
- 10 位色深下，从完整 0\~1024 缩减至 64\~940 的有限区间（876 深）
- 因为有限范围视频占据绝大多数，所以播放器默认读取有限范围，通过 Y/C 转换算出完整色深
- 图像格式有色深的概念，但不存在“有限范围”的概念
- 点击展开/折叠内容：密度与范围的用语说明
  色深密度代表色深大小所指的黑\~白区间密度，而“有限区间/范围”代表“密度里的有效范围”
- 严格地说，不存在“色深范围”，因为范围自始至终是黑到白，只有有限范围才能修改范围

#### 软件层完整范围 Full/PC

- 8 位密度下，色彩范围从 0 到 255 的完整 256 色深，密度较高

- 10 位密度下，色彩范围从 0 到 1023 的完整 1024 色深，密度很高

- 实际情况下，色深的视频剪辑软件选项应该设置为“保持和原素材一致”。因为：

  - 有的设备和软硬件默认导出有限范围，但录制的时候忘了改
  - 有的素材会误标记范围为有限
  - 有限和完整范围的转换可能会产生色带（Banding）失真

#### 色深转换的错误

点击展开/折叠内容

输出设置为有限，未经 Y/C 转换，连接到设置为输入完整范围的显示器，显示器缺失最暗和最亮的范围，呈现灰蒙蒙的画面，例如：

- PC 用 HDMI 连接显示器所致，需纠正显卡输出设置
- 显示器设置的对比度远高于亮度，需纠正显示器设置

输出设置为完整，未经 Y/C 转换，连接到设置为输入有限区间的显示器，显示器忽略 8bit 下 0\~15 和 235\~255 的亮度范围，出现画面过亮过暗（饱和度过高）的画面，例如：

- 古老 / 低成本的 HDMI 电视只支持有限范围，PC/Xbox/PlayStation 设置为输出完整所致

yuvj 色彩空间中的 j 被误解，而使用了无效或错误的转换处理导致

- j 代表 jpeg，是 ffmpeg 现已淘汰的定义，但 ffprobe 中可能还会遇到
- ffmpeg 的 color\_range 参数说明中可以看到 jpeg 和完整色域都是参数值 2

heic 格式的图片被错误转换到 jpeg 或错误显示导致，一般出现在手机上，以及 Windows 11 的图片浏览器中

HDR 视频在设备没有正确配置的情况下直接显示导致

### 伽马曲线/伽马映射

- **生理伽马映射**：人眼对于亮度的感知与物理亮度的线性变化所异

  - 人眼敏感于低至中等亮度的变化，而对中高亮度的变化则相对不太敏感。因此，当内容的亮度变化呈直线关系时，人们会感觉到“发白”
  - 许多游戏的初始设置中，“将滑块调节到能清晰看到左侧暗部图像”实际上就是在调节伽马曲线，而且是生理伽马曲线
  - 相机 CMOS 捕获的线性亮度（RAW 直出格式）在人眼看来会显得过亮“发白”，需要进行“黑化”校正

- **软硬件伽马映射**：屏幕电压与线性亮度变化之间的关系并非线性

  - CRT 显示屏一般需要放大电压到 \\( v^{2.2} \\) 才能够直线地显示亮度变化
  - sRGB 标准则因为 CRT 显示器的特性相当于已经对图像进行了“黑化”处理，因此在录制过程中就会将图像进行“白化”处理：\\( \gamma^{\frac{1}{2.2}} \\)
  - 若编辑 RAW 直出图像的软件未打开 Adobe 软件默认关闭的“按伽马系数混合 RGB 颜色，伽马值为 1”的设定，图层透明通道之间的过渡会显得杂乱不堪。

![Subsampling](files/basics/Y-Gamma.webp)

图：对亮度平面调整伽马映射，来源：[developer.apple.com](https://developer.apple.com/documentation/accelerate/adjusting-saturation-and-applying-tone-mapping)。

### 伽马矫正

**两种方式**：向上提亮缩放“白化” \\( s = cr^\frac{1}{\gamma} \\) 和向下变暗缩放“黑化” \\( s = cr^\gamma \\)。

![Gamma-Correction](files/basics/Gamma-Correction.png)

图：伽马矫正的指数算式，此处c = 1代表 0\~1 的亮度区间，8bit 256 深则c = 256，见[desmos 互动例](https://www.desmos.com/calculator/shseuk9jcb?lang=zh-CN)。

### 对比度 Contrast

任意量纲的间距。在图像与显示器中代表最亮\~最暗的亮度差，音频中代表“动态范围”，对比度低的图像会“发灰”，因为当前的亮度设置位于这个灰度水平上；对比度高的图像会显得生动，因为显示出来的色彩往往更符合心理预期。

![Contrast](files/basics/Contrast.webp)

图：对比度。

#### 对比过大的问题

在安静环境下听音乐时，有的音频段落会太响、画面亮度太刺眼；而有的场景下有小到听不清、或画面暗的看不清细节。

#### 调节对比度

在 DVD、蓝光播放机上，用户可以方便地通过遥控器调整；电脑麻烦些，需要通过调节显示器的 OSD 菜单，或下载第三方插件，或在播放器软件中按快捷键调节；智能手机可以通过显示色彩模式和第三方软件调节，但罕有播放器支持对比度调节，因此体验最差。

### 饱和度 Saturation

一般指液体在特定压力和温度下溶解了某种成分的程度，达到最高时会沉积而不再溶解。图像中则代表颜色接近 100% 纯色的程度或“彩度”，饱和度越高则图像越鲜艳，为零时得到灰阶图像；最大时得到纯色图像。对比度接近饱和度，但不是饱和度，从图中可见并没有白色溢出。

![Saturation](files/basics/Saturation.webp)

图：饱和度，来源：[developer.apple.com](https://developer.apple.com/documentation/accelerate/adjusting-saturation-and-applying-tone-mapping)。

### 像素 Pixel / pix / pel / px

像素是组成图像的最小单位，决定了图像的物理大小和分辨率。一般情况下分为屏幕的硬件像素大小，和图片/视频的软件像素大小两种。当软件像素小于硬件像素时，显示 100% 大小的图片会变小，或者通过缩放滤镜将图片放大以适应屏幕。反之，若硬件像素大小小于软件像素，则会使用缩放滤镜将图片缩小至合适的尺寸，或者图片会溢出屏幕。图像中的每个像素都有位置和颜色两份信息。

### 每英寸像素 Pixel Per Inch / PPI

指屏幕或印刷设备上的物理像素密度，这取决于设计时预期的观看距离。屏幕的 PPI 高则适合近距离观看，因为物理像素更密集。在印刷设备的 PPI 越高，打印出的图像就越细腻。软件的 PPI 主要用于计算新建图像的像素大小和分辨率，以确保图像有着适当的大小和清晰度。

- 矢量图形通常不涉及 PPI 概念，因为它们以数学方式描述图像，可以无限放大而不失真
- 高 PPI 的显示器是一种较新的规格，旧的软件在这些显示器上会出现模糊，或界面过小的问题，见[硬件茶谈](https://www.youtube.com/watch?v=jfAH4Ym5D6Q)

![PPI](files/basics/ppi.svg)

图：每英寸像素，来源：[www.inchcalculator.com](https://www.inchcalculator.com/ppi-calculator/)。

### 色彩空间 Color Space

用于表示和处理图像颜色的数据格式，具有适用于各种不同应用场景的多种类型。最常用的是分为硬件和操作系统的 RGB 色彩空间，以及内容的 YUV/YCbCr 色彩空间。见 [Captain Disillusion](https://www.youtube.com/watch?v=FTKP0Y9MVus) 的科普。

![RGB-to-YCbCr-to-RGB](files/basics/RGB-to-YCbCr-to-RGB.png)

RGB 色彩空间由红色 Red、绿色 Green、蓝色 Blue 三个通道组成，每个通道的数值表示相应颜色的强度，对应着显示器红色 LED，绿色 LED 和蓝色 LED。常用于显示器、摄像头和图形处理等硬件和软件系统中。

YUV/YCbCr 色彩空间是另一种常见的色彩表示方式，用于存储和传输视频数据。Y 代表亮度 Luminance，而 U、V 代表色度 Chrominance。严格的说，YCbCr 特指数字信号，YUV 特指模拟信号，但由于后者字数更少且打字容易，所以现在常被混为一谈了。

| 🎆色彩格式          | 构成色         | 特点   | 存在原因       | 支持范围     |
| --------------- | ----------- | ---- | ---------- | -------- |
| RGB             | 红绿蓝         | 通用   | 使显示器/照相机通用 | 几乎所有可视媒体 |
| ARGB            | α 红绿蓝       | 透明通道 | 便于图层化编辑    | 图片，部分视频  |
| CMYK            | 湛 zhàn 洋黄黑  | 减法色彩 | 卖墨盒        | 打印纸      |
| YCbCr/YUV，YPbPr | 白蓝 - 黄红 - 绿 | 压缩   | 压缩视频图片     | 所有有损压缩   |

### 色度采样 Chroma Subsampling

YUV/YCbCr 色彩空间下，利用人眼对色度细节不敏感的特性（见下图全分辨率和半分辨率的色度面），降低色度平面的分辨率，从而压缩图像。色度采样格式通常用三个数字表示，例如 4:4:4、4:2:2 等。编码时下采样，解码时上采样。

![Subsampling](files/basics/Subsampling.png)

图：色度采样，来源：[developer.apple.com](https://developer.apple.com/documentation/accelerate/adjusting-saturation-and-applying-tone-mapping)。

A:B:C 代表微观分辨率下，每个长 A 像素，高 2 像素的空间，第一行缩到 B 个色度像素，第二行缩到 C 个色度像素。如 4:2:2 代表色度平面的每个 4x2 微观区间中，第一行的色度分量保留 2 个像素，第二行的色度分量也保留 2 个像素。色度采样详见下表：

| 👾采样         | 1920x1080 下宏观                                         | 色度 4x2 微观         |    |                   |    | 特点                                                                           |
| ------------ | ----------------------------------------------------- | ----------------- | -- | ----------------- | -- | ---------------------------------------------------------------------------- |
| 4:4:4        | 亮度，色度皆 100% 宽 100% 高（色度 1920x1080）                    | 色素                | 色素 | 色素                | 色素 | 视频滤镜可直接作用于亮度或色度平面， 而 RGB 色彩空间需要转过去、应用滤镜、再转换回来， 因此非常适合图像和视频编辑，并且便于压缩色度平面      |
|              |                                                       | 色素                | 色素 | 色素                | 色素 |                                                                              |
| 4:2:2        | 亮度 100% 宽 100% 高，色度 50% 宽 100% 高（色度 960x1080）         | 色素 ←              |    | 色素 ←              |    | 逐行扫描，色度像素靠插值放大补全。 由于人眼对色度变化不敏感，同时使用整数倍的缩小放大， 因此在提高压缩的同时除了边缘细节对齐误差外的损失可以忽略不计  |
|              |                                                       | 色素 ←              |    | 色素 ←              |    |                                                                              |
| 4:2:0        | 亮度 100% 宽 100% 高，色度 50% 宽 50% 高 960x540               | 色素 ← ↑       ⬉    |    | 色素 ← ↑       ⬉    |    |                                                                              |
| 4:0:0        | 亮度 100% 宽 100% 高的灰度视频，或丢弃色度信息的图像/视频                   |                   |    |                   |    |                                                                              |
| 4:1:1        | 亮度 100% 宽 100% 高，色度 25% 宽 100% 高 480x1080             | 色素 ← ← ← ←        |    |                   |    | 交错扫描 Interlaced，横着扫描可以避免将上场、下场的像素混淆                                          |
|              |                                                       | 色素 ← ← ← ←        |    |                   |    |                                                                              |
| 4:1:1-par4:3 | 亮度 75% 宽 100% 高，1440x1080 色度 18.75% 宽 100% 高，360x1080 | 色度像素 ←×5.333      |    |                   |    |                                                                              |
|              |                                                       | 色度像素 ←×5.333      |    |                   |    |                                                                              |
| 4:2:0-par4:3 | 亮度 75% 宽 100% 高，1440x1080 色度 37.5% 宽 50% 高，720x540    | 2.667 ← ↑ 2.848 ⬉ |    | 2.667 ← ↑ 2.848 ⬉ |    | 逐行扫描，非方形亮度像素，除了清晰度更低，色度像素在拉伸后也会出现更大的对齐偏差，曾被用于电视台和视频网站（有的横向有的纵向）压缩视频，现在基本已经绝迹 |

![Color-Space-Handling](files/basics/Color-Space-Handling.jpg)

图：RGB 与 YCbCr 的转换，色度采样的使用及编解码与录制、传输和显示的关系

### 视频帧 Video Frame

描述连续图片序列中的单张图片（随便拍一张图片不算，连拍算）。有帧大小、帧率/帧数、帧类型（关键帧，过渡帧）等描述规格，构成了图像内容运动的假象。

### 帧率 Frame Rate / Frames per second / FPS

每秒刷新的图像帧数，越高则变化越流畅。不同的内容类型会根据视频标准，成本和艺术效果来选择一个合适的帧率来拍摄和制作。

### 画面流畅度 Video fluidity

在智能手机产品的发展阶段，有个叫一加的品牌率先推出了 90 Hz 屏幕的手机，这使得系统流畅度，以及用户体验被显著提升，该手机也成为了当年的热门产品；而与此同时，电影、电视剧的 24 fps 是流畅的、浏览器观看网页的 60 fps 是流畅的、漫画材质动画的 23.976（24 fps 丢帧）同样是流畅的，唯独第一人称射击的电子竞技（e-Sport FPS）游戏选手和同类游戏玩家纷纷放弃了更高分辨率的显示器，而是专门选购了 120 Hz 或更高的显示器，将游戏画质设置到最低，只为降低延迟。

随着帧间插值渲染（Frame Interpolation）所依赖的 GPU 效率变得足够快，便有许多人尝试对电影和漫画材质动画插帧，从而使画面流畅，然而结果不是充斥伪运动感的飘忽画面，就是因画面前后部分范围突变而产生了采样错误；与此同时，使用 Live2D 动补技术创建的虚拟形象却让漫画材质动画的人物图层在 60 fps 帧率下活灵活现的显示。这种属于 3D 材质动画的流畅在每一名使用 Live2D 以及其相关技术的主播上都能轻松实现，却是插帧滤镜用户无法跨越的技术鸿沟。

实际上，流畅度的核心在于移动画面的保真，符合这个条件的画面类型有背景平移（Panning），充斥智能手机的全屏动画，FPS 游戏的发现到杀敌用时（TTK）等“帧率不够就会丢失动态信息”的情况。因此，每一帧画面只有在正确的时间显示正确的时长，才能对流畅度有所贡献。

录像电影和漫画材质动画有着内容生产和储存的成本与时限，自然不会随意地提高帧率。但低帧率有低帧率的办法——电影会限制镜头平移速度（即电影运镜）、对快速移动的物件添加动态模糊（摄影快门角度和速度）；漫画材质动画会利用视觉暂留效应的一拍 N 作画，也会使用室内等移动物件少的场景，这才在更低的帧率下实现了对人眼来说足够流畅的画面，这种“已流畅”的画面自然是无法通过简单的插帧来提高流畅度的。

随着手机剪辑网络视频的流行，更多的“纯文本”视频开始涌现到视频网站。这些视频往往就算只有 1 fps（1 帧每秒）、0.2 fps（5 秒每帧）也会是无比流畅的。

#### 恒定帧率、可变帧率 Constant / Variable frame rate

恒定帧率的视频播放和剪辑都最具兼容性。可变帧率技术有助于解决手机录像时的发热和耗电速度快的问题，但也有着剪辑软件兼容性的问题（每个用到的滤镜都必须支持可变帧率）。因此，录制视频时应根据设备的电量和散热能力进行选择，而录制需要剪辑的素材时则应选择恒定帧率。

点击展开/折叠内容：ffmpeg 转换到恒定帧率的命令

`ffmpeg -i <输入> -vsync cfr -y -vf fps=60 -c:a copy -f yuv4mpegpipe - | x264 <参数> - --demuxer y4m --output <输出.mp4>`

- 于视频元数据里也有着标错的情况，所以用 MediaInfo 等工具查看到视频帧率是 Variable 时，还要用播放器逐帧查看，或者用 ffprobe 检测。见 [ffprobe 教程](https://nazorip.site/archives/169/)

#### 小数帧率 / 丢帧、剪辑素材对齐问题

NTSC 模拟电视每个频道的标准带宽大约为 6MHz（但实际宽度仅为 4.5MHz）。接下来发生的事谁都没有预料到——彩色电视出现了。结果是原本的频宽完全放不下彩色电视台信号，而且由于电视机已经售出，不可能更改用户家里电视的频宽和扫描线的数量。最终解决方案是在每秒 30 帧的基础上丢掉一帧，并加速 1 秒到 1.1001 秒，以保持与帧率的对齐（同时也引入了 YUV 4:2:0 色彩空间）。经过这般折腾，码率/频宽总算被压缩了下来，但后继影响了数字视频的丢帧帧率标准——为了与模拟电视兼容[Reddit: GhostOfSorabji](https://www.reddit.com/r/finalcutpro/comments/mm58qp/why_on_earth_do_we_have_2997fps_what_madness_is/)。

![Aligning-framerates](files/basics/Aligning-framerates.jpg)

图：不同帧率的对齐问题，如果素材的帧率不统一就会出现的“快慢帧”问题，见[Taran Van Hemert](https://www.youtube.com/watch?v=p3Jb3UPAw-w)

在视频编辑中有时会遇到对齐“不同帧率”乘以“不同帧率种类”视频素材的困难问题，处理起来非常考验剪辑水平。但与其这样，不如一开始就商量好使用正确的录制设定就可以了。

### 逐行/交错扫描 Progressive / Interlaced

逐行扫描通过一行行从左到右地刷新像素来构建图像，是最为常用的屏幕刷新方式。交错扫描的方法不同，它使用 YUV 4:1:1 采样，将屏幕的奇数像素行视为一个场，偶数像素行视为另一个场。这两个场在录制时错开一定时间，这样在模拟电视上观看时会产生 60fps 的视觉效果。交错扫描的原理是为了节省模拟电视信号的频段区间（与收音机接收电台信号一样）。因此，通过在时间上分隔行来节省空间，可以几乎将每个频道的频宽减半，例如（\\(525 \text{行} \times 30\text{fps} = 15.75 \text{MHz}\\)）。

![PAL-NTSC-SECAM](files/basics/PAL-NTSC-SECAM.svg)

图：NTSC，PAL 和 SECAM 播放规格的地区分布，见[维基百科](https://en.m.wikipedia.org/wiki/File:PAL-NTSC-SECAM.svg)

### 音频格式（一维）

最简单的结构为——脉冲编码调制 Pulse-code modulation（PCM）信号。见[维基百科](https://zh.wikipedia.org/wiki/%E8%84%88%E8%A1%9D%E7%B7%A8%E7%A2%BC%E8%AA%BF%E8%AE%8A)。

| 🎶压缩 | 格式                       | 音质                                   |
| ---- | ------------------------ | ------------------------------------ |
| 有损   | mp3，aac，ogg（vorbis/opus） | 取决于耳机/音响，混音，声场。分为 HiFi 音频和监听音频两种质量参考 |
| 无损   | flac，alac，ape，it         |                                      |
| 未压缩  | wav（PCM）                 |                                      |

### 图像格式（二维）

最简单的结构为 PCM 信号 + 每 n 个像素换行的元数据

| 📷压缩       | 格式                  | 最大 RGB 色深   | 最大 YCbCr 色深 | 最大 CMYK 色深      | 动图    | HDR | 透明     |
| ---------- | ------------------- | ----------- | ----------- | --------------- | ----- | --- | ------ |
| 有损         | jpg                 | 8 8 8       | 8 8 8       | 24 24 24 24     |       |     |        |
| 有\~无损      | gif（编码无损，颜色少了）      | 24×3 中取 8×3 |             |                 | ✓     |     | 仅 1bit |
|            | webp                | 8 8 8       | 8 8 8       |                 | ✓     |     | ✓      |
|            | jpg-XR（兼容 jpg）      | 32 32 32    | 8 8 8       | 16 16 16 16     | ✓     | ✓   | ✓      |
|            | avif，heif/heic，filf | 32 32 32    | 16 16 16    |                 | ✓     | ✓   | ✓      |
| 无损         | pdf，jpg-LS，png      | 16 16 16    |             | 32 32 32 32     | 仅 mng |     | ✓      |
| 有损\~无损\~未压 | tif                 | 16 16 16    | 8 8 8       | 128 128 128 128 |       | ✓   | ✓      |
| 未压缩        | raw，bmp             | 24 24 24    |             |                 | 仅 raw | ✓   | ✓      |
|            | dpx                 | 64 64 64    | 16 16 16    |                 | ✓     | ✓   |        |

### 视频格式（三维）

最简单的结构为一组图片。

| 🎥压缩       | 格式                                    | RGB/YCbCr 色深 | HDR       | 透明       |
| ---------- | ------------------------------------- | ------------ | --------- | -------- |
| 有\~无损      | qt，hevc，avc，vvc，vp8/9，DNxHR/HD，prores | 12 12 12     | 除 avc，vp8 | 仅 prores |
| 无损         | rawvideo                              | 32 32 32     |           | ✓        |
|            | cineform                              | 16 16 16     | ✓         |          |
| 有损\~无损\~未压 | Flash 动画                              | 内嵌图片决定       |           |          |

#### 动图 vs 视频 vs 图片序列

图片与视频之间还有图像序列，动图两种中间格式。图像序列直接储存视频为大量图像，一般用于录制素材；动图如 .gif，.mng 则表面上和视频一致：

| 设计\格式 | 动图编码       | 视频编码        | 图片序列 |
| ----- | ---------- | ----------- | ---- |
| 播放用时  | 短（GOP = 1） | 长（GOP >= 1） | 无    |
| 帧率    | 随便         | 随便          | 随便   |
| 分辨率   | 随便         | 随便          | 随便   |
| 帧间冗余  | 一般不支持      | 一般都支持       | 无    |
| 需要封装  | 无          | 一般都需要       | 无    |

### 滤镜/滤波器 Filter 与滤镜工具

通常用于过滤水和净化空气。在信号中代表处理一维音频和二维视频信号的算法。滤镜工具代表能够将滤镜应用到信号上的软件或插件，比如 Adobe Premiere Pro，After Effects，[ffmpeg](https://ffmpeg.org/)，[DaVinci Resolve](https://www.blackmagicdesign.com)，[ScreenToGIF](https://www.screentogif.com/)，[FL Studio](https://www.image-line.com)，[Reaper](https://www.reaper.fm/)，[Ableton](https://www.ableton.com/)，Audition，[GIMP](https://www.gimp.org/)，Photoshop，[FSCapture](https://www.faststone.org/FSCaptureDetail.htm)，LightRoom，OpenCV 等编辑图像、视频和音频的工具。[AviSynth(+)](https://avs-plus.net/)和 VapourSynth 严格上称为帧服务器，因为需要连接一个编码器才能导出视音频。

### 噪声 Noise 与颗粒 Grain

电影胶片（卤化银晶体）被投影灯放大得到胶片颗粒 Film Grain，在单独一帧胶片画面上是一种比较自然静态噪声。更广义且不自然的噪声来自于电视信号接收器或相机使用放大电路 amplifier 放大无信号频段，或黑暗场景产生的“雪花”画面和声音。以及根据厂家镀膜工艺水平而定的显示器屏幕磨砂表面“静态噪声”等等。

一般来说，如果噪点的边角尖锐，缺乏渐变，则是“难看的噪声”。另一种比较极端的判断方法是——只有影视导演亲手保留，或游戏美工专门根据显示技术适配处理过的噪声才是好看的噪声、由第三方私自添加的噪声是“难看的噪声”。

实际上，人眼的“成像技术”也决定了人看到的画面本来就有很多噪点，而且是动态噪点，只是未注意的时候都是大脑的实时降噪和幻觉在抑制而已。

![imax-tape-projector](files/basics/imax-tape-projector.jpg)

图：正在放映 2023 年电影《奥本海默》的 70mm IMAX 胶片放映机。源：[Nicolas Vega](https://www.cnbc.com/2023/07/19/where-to-watch-oppenheimer-in-70mm-imax-.html)

![matte-vs-glossy](files/basics/matte-vs-glossy.jpg)

图：同一个 OLED 面板前方使用磨砂镀膜与镜面镀膜的微观区别。可以看到没有漫反射的镜面更“通透”。当然，后者的纯色光更容易聚集，LED 调整亮度所必须的频闪亮度变化也更大，容易导致眼部刺痛、散光。源：[The Display Guy](https://www.youtube.com/watch?v=mZjxEcuVHlQ)

### 抖动滤镜 Dither Filter

源自早期操作系统只能显示有限数量的颜色，因此采用了高频闪烁两种颜色的方法来欺骗视觉（副作用是使人感到晕眩）。在图像、音频和低端显示器中，抖动滤镜代表通过分辨率或采样率来换取位深的加噪补偿手段。

点击展开/折叠内容：常用的抖动滤镜，可略

具体来说，通过间隔几个像素就调亮/调暗一个像素的颜色，使得宏观整体上看起来像是淡化或加深；在音频位深分量两端的采样点间成比例的（以方形波或三角波信号）快速摆动，从而利用扬声器反应速度，起到淡化或深化偏移宏观上位深的效果。

![Audio-Dither](files/basics/Audio-Dither.png)

图：音频的采样点，以及下采样音频，抖动关对比开的效果，见[Micoope 科普](https://micoope.com.gt/?s=what-is-audio-dithering-and-why-it-s-used-aa-BaD6b0T5)。

![Dither-1](files/basics/Image-Dither-1.png)

图：下采样 8bit 到 1bit，开抖动的效果

抖动滤镜的效果主要是欺骗视觉，但因为效果独特，所以衍生出了 Ditherpunk 抖动朋克美术。典型如 1bit 游戏《奥博拉丁的回归》贯彻了这种风格——利用[随机](https://bartwronski.com/2016/10/30/dithering-part-one-simple-quantization/)，[蓝噪声](https://bartwronski.com/2016/10/30/dithering-part-two-golden-ratio-sequence-blue-noise-and-highpass-and-remap/)，[蓝噪声，黄金分割](https://bartwronski.com/2016/10/30/dithering-part-two-golden-ratio-sequence-blue-noise-and-highpass-and-remap/)，[Riemersma](https://www.compuphase.com/riemer.htm) 等不同的加噪算法来定义游戏引擎的材质。

![Dither-2](files/basics/Image-Dither-2.png)

图：图像噪声算法

### 缩放滤镜 Resize Filter

Windows 系统一般用双线性缩放放大 PPI 小的软件，视频视频播放器一般用 bicubic 或 lanczos 插值

点击展开/折叠内容：更改图像大小的各种算法，可略

##### 临近取样插值 Nearest Neighbour interpolation（NN）：

1. 2x2 的四个像素点移动到缩放后的四个位置
2. 待插值的像素中，距离哪四个点近的像素就取哪个像素的值

##### 双线性插值 Bi-linear interpolation（Bi-lerp / Bilinear）：

1. 2x2 的四个像素点移动到缩放后的四个位置
2. 横向和纵向的点（像素值）间各连一条线
3. 采样得到中间的像素，完成四边的插值
4. 四边之间接着分为横向与纵向边缘
5. 横向和纵向的边（像素值）间各连一条线，共六横六纵
6. 所有线段接着采样得到中间的插值像素点，且在横纵线的两种插值之间取平均

##### 样条插值 Spline interpolation（spline）：

1. “样条”代表软木条，通过铁钉塑形结合木条的应力做出连贯且一致的曲线
2. 这种性质可以用多项式准确描述，而图像中的“铁钉”就是像素值
3. 图像中的“木条”就是在 n 个“铁钉”构成的 n-1 个区间里各画一条曲线
4. 二次多项式插值 quadratic interpolation 代表三个点间用二次多项式插值
5. 三次多项式插值 cubic interpolation 代表四个点间用三次多项式插值，适用于放大图像
6. 连起的线必须平滑连贯，数学上叫做“二阶导数连续”
   - 因此，放大一个 2x2 的区间需要 4x4 范围的采样点
7. 插值的与逻辑和双线性插值一致，同时是三次多项式插值，则是双三次多项式插值 bi-cubic interpolation

##### Lanczos 插值：

使用 sinc 函数取近似，且引入了窗函数来矫正 sinc 函数，同时要计算 lanczos 核实现插值。计算量大，准确度略高于 bicubic 插值。

##### 神经网络缩放滤镜：

通过认知大量训练数据，在其中找出更高维度规律的情况下，利用这些规律推断像素值。计算量极大，准确度时高时低。

### 宽高比（Aspect Ratio）

矩形的最小两边的比例，被中国航空航天称为展弦比。被忽略的“长”是屏幕相对人眼的 z 轴。而换算长短边如 16:9 高 720 的方形像素视频，其宽就是 \\( 720 \div 9 \times 16 = 1280 \\)。

![Aspect-Ratio-16-by-9](files/basics/Aspect-Ratio-16-by-9.png)

图：16:9 的矩形整数偶数放大后的图像分辨率

图片格式一般支持奇数分辨率，视频一般仅支持偶数分辨率。

### 程序的交互界面（Interface）

**图形界面交互（Graphic user interface、GUI、UI）**：通过图形元素（如按钮、滑块、菜单等）进行用户交互的界面设计。随着程序复杂度的增加，设计出好用的界面会变得更加困难。因此，只有在利润丰厚、注重美学设计、且拥有设计人才的行业才会推出外观精美的 GUI。然而，好看不等于好用。在视频压制相关的任务中，加了图形界面反而会引出一系列问题，例如关键功能或信息缺失、报错信息丢失、内容溢出窗口、操作流程复杂化等问题。

![FL-Studio-GUI-Demonstration](files/basics/FL-Studio-GUI-Demonstration.png)

图：音频插件宿主软件 FL Studio，外加一堆免费和“免费”音频插件随便摆放的外观

![XAMPP-GUI-Demonstration](files/basics/XAMPP-GUI-Demonstration.png)

图：网页服务器宿主软件 XAMPP 的 GUI（左下为 CLI），作为跨行业对比

**命令行交互（Commandline interface、CLI）**：在如 Terminal、Bash、CMD 和 PowerShell 的终端环境中，用户可以手动输入命令并按回车键查看结果。通常，只要输出结果有一定的文本排版，就可以轻松阅读。随着使用的增加，CLI 可能反而会变得比 GUI 更方便。然而，由于某些命令太长，而且需要储存变量，因此为了简化操作，人们会将其写作批处理、Shell 等命令脚本文件。例如[PowerShell 一站式系统硬件检测](https://nazorip.site/archives/835/)的脚本。

![Ubuntu-Terminal](files/basics/Ubuntu-Terminal.png)

图：Ubuntu（Linux 系统）的终端命令交互程序窗口。

**应用编程交互（Application programming interface、API）**：定义编译好的软件应用程序之间应该如何如何相互通信的规则。主要分为跨网络的 API（调用数据库、调用其他网站资源）和本地程序之间（软件、操作系统、电脑硬件）的 API。API 可以被看作是 CLI 的映射。
